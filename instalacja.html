<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Paczkomaty InPost osCommerce Module</title>
  <style>
  	textarea { background: #FFFACD; padding: 10px; margin-bottom: 20px; border:1px solid silver; width: 98%; font-family: monospace; }
  </style>
</head>
<body>
	<h2>Instalacja Modułu Paczkomaty InPost dla osCommerce 2.3</h2>
	<ol>
		<li><a href="#upload_file">Upload plików</a></li>
		<li><a href="#edit_existing">Edycja istniejących plików</a></li>
		<li><a href="#module_install">Instalacja modułu</a></li>
	</ol>
	
	<br />
	<h3><a name="upload_file"></a>Upload plików</h3>
	<p>Nowe pliki, które należy umieścić na serwerze w odpowiednich katalogach, zainstalowanego systemu osCommerce.</p>
<textarea rows="4" readonly="readonly">
/includes/functions/inpost_functions.php
/includes/languages/polish/modules/shipping/paczkomaty.php
/includes/modules/shipping/paczkomaty.php
</textarea>
	
	<br />
	<h3><a name="edit_existing"></a>Edycja istniejących plików</h3>
	<p>Wprowadź zmiany opisane poniżej dla każdego z pliku. Numery lini są szacunkowe dla nieedytowanej wcześniej kopi pliku.</p>

	<p><strong>Otwórz plik <code>/checkout_shipping.php</code></strong></p>
	<code>ZNAJDŹ KOD (linia 122):</code>
<textarea rows="4" readonly="readonly">
$shipping = array('id' => $shipping,
	'title' => (($free_shipping == true) ?  $quote[0]['methods'][0]['title'] : $quote[0]['module'] . ' (' . $quote[0]['methods'][0]['title'] . ')'),
	'cost' => $quote[0]['methods'][0]['cost']);
</textarea>
	<code>DODAJ PO NIM:</code>
<textarea rows="7" readonly="readonly">
// start paczkomaty
if (preg_match('/paczkomaty_/', $shipping['id'])) {
	$pa = new Paczkomaty();
	$shipping = $pa->oscomm_prepare_shipping($quote, $shipping, $free_shipping);
} 
// end paczkomaty	
</textarea>

	<p><strong>Otwórz plik <code>/checkout_shipping.php</code></strong></p>
	<code>ZNAJDŹ KOD (linia 274):</code>
<textarea rows="5" readonly="readonly">
	} else {
          for ($j=0, $n2=sizeof($quotes[$i]['methods']); $j<$n2; $j++) {
// set the radio button to be checked if it is the method chosen
            $checked = (($quotes[$i]['id'] . '_' . $quotes[$i]['methods'][$j]['id'] == $shipping['id']) ? true : false);
</textarea>	
	<code>DODAJ PRZED NIM:</code>
<textarea rows="22" readonly="readonly">
// start paczkomaty
	} elseif ($quotes[$i]['module'] == MODULE_SHIPPING_PACZKOMATY_TEXT_TITLE) {
		$pa = new paczkomaty();
       	$checked = preg_match('/paczkomaty/', $shipping['id']);
		if ( ($checked) || ($n == 1 && $n2 == 1) ) {
			echo '<tr id="defaultSelected" class="moduleRowSelected" onmouseover="rowOverEffect(this)" onmouseout="rowOutEffect(this)" onclick="selectRowEffect(this, '.$radio_buttons.')">';
   		} else {
   			echo '<tr class="moduleRow" onmouseover="rowOverEffect(this)" onmouseout="rowOutEffect(this)" onclick="selectRowEffect(this, '.$radio_buttons.')">';
   		}
   		echo '<td width="75%" style="padding-left: 15px;">'.$pa->oscomm_paczkomaty_dropbox($quotes[$i], $shipping).'</td>';
   		echo '<td>'.$currencies->format(tep_add_tax($quotes[$i]['methods'][0]['cost'], (isset($quotes[$i]['tax']) ? $quotes[$i]['tax'] : 0))).'</td>';
		echo '<td align="right">'.tep_draw_radio_field('shipping', $quotes[$i]['id'] . '_' . $quotes[$i]['methods'][0]['id'], $checked, 'id="shipping_paczkomaty"').
				'<script type="text/javascript">
					function changeCheckedValue(obj) {
						document.getElementById("shipping_paczkomaty").value = obj.options[obj.selectedIndex].value;
					}
					changeCheckedValue(document.getElementById("dropbox_paczkomaty"));
				</script>
	        	</td>';
		echo '</tr>';
// end paczkomaty */
</textarea>

	<p><strong>Otwórz plik <code>/checkout_confirmation.php</code></strong></p>
	<code>ZNAJDŹ KOD (linia 65):</code>
<textarea rows="3" readonly="readonly">
	require(DIR_WS_CLASSES . 'shipping.php');
  	$shipping_modules = new shipping($shipping);
</textarea>
	<code>DODAJ PO NIM:</code>
<textarea rows="7" readonly="readonly">
// start paczkomaty
	if (preg_match('/paczkomaty_/', $shipping['id'])) {
		if ($shipping['payment_cod'] == 'f' && $payment == 'cod')
			tep_redirect(tep_href_link(FILENAME_CHECKOUT_SHIPPING, 'error_message='.MODULE_SHIPPING_PACZKOMATY_ERROR_UNAVAILABLE_COD, 'SSL'));
	} 
// end paczkomaty	
</textarea>

	<p><strong>Otwórz plik <code>/checkout_process.php</code></strong></p>
	<code>ZNAJDŹ KOD (linia 286):</code>
<textarea rows="4" readonly="readonly">
	$payment_modules->after_process();

	$cart->reset(true);
</textarea>
	<code>DODAJ PO NIM:</code>
<textarea rows="7" readonly="readonly">
// start paczkomaty 
	if (preg_match('/paczkomaty_/', $shipping['id'])) {
		$pa = new Paczkomaty();
		$pa->create_packs($shipping, $payment, $order->info['total']);
	} 
// end paczkomaty	
</textarea>

	<p><strong>Otwórz plik <code>/includes/database_tables.php</code></strong></p>
	<code>DODAJ WPIS:</code>
<textarea rows="4" readonly="readonly">
// start paczkomaty
	define('TABLE_EXTERNAL_PACZKOMATY_INPOST', 'external_paczkomaty_inpost');
// end paczkomaty	
</textarea>

	<br />
	
	<h3><a name="module_install"></a>Instalacja modułu</h3>
	<p>Instalacja modułu odbywa sie w panelu Administracyjnym.</p>
	<code>
		<ol>
			<li>Korzystając z menu głównego, rozwiń zakładkę Moduły (Modules), a nasępie wybierz opcję Dostawy (Shipping)</li>
			<li>Zainstaluj Moduł (Install Module) i wybierz z listy Paczkomaty InPost)</li>
			<li>Opcje konfiguracyjne dla modułu to:
				<ul>
					<li>Adres URL do API - domyślnie https://api.paczkomaty.pl</li>
					<li>Paczkomat nadawczy (Nadawanie paczek bezpośrednio w Paczkomacie) - domyślnie wyłączony (wartość pusta), aby włączyć opcję należy podać odpowiedni kod Paczkomatu (<a href="http://www.paczkomaty.pl/znajdz_paczkomat,33.html" target="_blank">znajdź paczkomat</a>)</li>
					<li>Email konta sklepu zarajestrowanego w usłudze Pakomaty InPost - domyślnie ustawiony email konta testowego</li>
					<li>Hasło do konta sklepu zarajestrowanego w usłudze Pakomaty InPost - domyślnie ustawione hasło do konto testowego</li>
					<li>Typ paczki generowanej w Managerze Paczek Paczkomaty InPost - domyślnie typ A (dostępne: A, B, C)</li>
					<li>Cena wysyłki za pomoca usługi Pakoczmaty InPost - domyślnie 6.99</li>
				</ul>
			</li>
		</ol>
	</code>
</body>
</html>
